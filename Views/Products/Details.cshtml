@model LaptopShopWebsite.Models.Product
@{
    ViewData["Title"] = Model.Name;
}

<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Breadcrumb -->
        <nav class="mb-8">
            <ol class="flex items-center space-x-2 text-sm text-gray-500">
                <li><a asp-controller="Home" asp-action="Index" class="hover:text-blue-600">Trang chủ</a></li>
                <li><i data-lucide="chevron-right" class="h-4 w-4"></i></li>
                <li><a asp-controller="Products" asp-action="Index" class="hover:text-blue-600">Sản phẩm</a></li>
                <li><i data-lucide="chevron-right" class="h-4 w-4"></i></li>
                <li class="text-gray-900">@Model.Name</li>
            </ol>
        </nav>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 mb-16">
            <!-- Product Images -->
            <div>
                <div class="bg-white rounded-lg shadow-md overflow-hidden mb-4">
                    <img id="main-image" src="@Model.Image" alt="@Model.Name" class="w-full h-96 object-cover" />
                </div>
                <div class="grid grid-cols-4 gap-2">
                    @foreach (var image in Model.Images)
                    {
                        <button onclick="changeImage('@image')" class="bg-white rounded-lg shadow-md overflow-hidden hover:ring-2 hover:ring-blue-500 transition-all">
                            <img src="@image" alt="@Model.Name" class="w-full h-20 object-cover" />
                        </button>
                    }
                </div>
            </div>

            <!-- Product Info -->
            <div class="bg-white rounded-lg shadow-md p-8">
                <div class="flex items-center justify-between mb-4">
                    <span class="text-sm text-gray-500 font-medium">@Model.Brand</span>
                    <div class="flex items-center space-x-1">
                        <i data-lucide="star" class="h-5 w-5 text-yellow-400 fill-current"></i>
                        <span class="text-sm text-gray-600">@Model.Rating (@Model.Reviews đánh giá)</span>
                    </div>
                </div>

                <h1 class="text-3xl font-bold text-gray-900 mb-4">@Model.Name</h1>

                <div class="flex items-center space-x-4 mb-6">
                    <span class="text-3xl font-bold text-blue-700">
                        @Model.Price.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))
                    </span>
                    @if (Model.OriginalPrice.HasValue)
                    {
                        <span class="text-xl text-gray-500 line-through">
                            @Model.OriginalPrice.Value.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))
                        </span>
                        <span class="bg-red-100 text-red-800 px-2 py-1 rounded-md text-sm font-semibold">
                            Tiết kiệm @((Model.OriginalPrice.Value - Model.Price).ToString("C0", new System.Globalization.CultureInfo("vi-VN")))
                        </span>
                    }
                </div>

                <!-- Quick Specs -->
                <div class="grid grid-cols-2 gap-4 mb-6 p-4 bg-gray-50 rounded-lg">
                    <div>
                        <span class="text-sm text-gray-500">CPU:</span>
                        <p class="font-medium">@Model.Processor</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">RAM:</span>
                        <p class="font-medium">@Model.Ram</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Ổ cứng:</span>
                        <p class="font-medium">@Model.Storage</p>
                    </div>
                    <div>
                        <span class="text-sm text-gray-500">Card đồ họa:</span>
                        <p class="font-medium">@Model.Graphics</p>
                    </div>
                </div>

                <!-- Stock Status -->
                <div class="flex items-center space-x-2 mb-6">
                    @if (Model.InStock > 0)
                    {
                        <i data-lucide="check-circle" class="h-5 w-5 text-green-500"></i>
                        <span class="text-green-600 font-medium">Còn @Model.InStock sản phẩm</span>
                    }
                    else
                    {
                        <i data-lucide="x-circle" class="h-5 w-5 text-red-500"></i>
                        <span class="text-red-600 font-medium">Hết hàng</span>
                    }
                </div>

                <!-- Add to Cart -->
                <div class="flex space-x-4 mb-6">
                    <div class="flex items-center border border-gray-300 rounded-lg">
                        <button onclick="decreaseQuantity()" class="px-3 py-2 hover:bg-gray-100">-</button>
                        <input id="quantity" type="number" value="1" min="1" max="@Model.InStock" class="w-16 text-center border-0 focus:ring-0" />
                        <button onclick="increaseQuantity()" class="px-3 py-2 hover:bg-gray-100">+</button>
                    </div>
                    <button onclick="addToCart('@Model.Id')" 
                            class="flex-1 bg-blue-700 text-white py-3 px-6 rounded-lg hover:bg-blue-800 transition-colors flex items-center justify-center space-x-2"
                            @(Model.InStock == 0 ? "disabled" : "")>
                        <i data-lucide="shopping-cart" class="h-5 w-5"></i>
                        <span>@(Model.InStock == 0 ? "Hết hàng" : "Thêm vào giỏ hàng")</span>
                    </button>
                </div>

                <!-- Features -->
                <div class="border-t pt-6">
                    <div class="flex items-center space-x-6 text-sm text-gray-600">
                        <div class="flex items-center space-x-2">
                            <i data-lucide="shield-check" class="h-4 w-4"></i>
                            <span>Bảo hành chính hãng</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <i data-lucide="truck" class="h-4 w-4"></i>
                            <span>Miễn phí vận chuyển</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <i data-lucide="refresh-cw" class="h-4 w-4"></i>
                            <span>Đổi trả 7 ngày</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Details Tabs -->
        <div class="bg-white rounded-lg shadow-md mb-16">
            <div class="border-b">
                <nav class="flex space-x-8 px-8">
                    <button onclick="showTab('description')" id="tab-description" class="py-4 px-1 border-b-2 border-blue-500 text-blue-600 font-medium">
                        Mô tả sản phẩm
                    </button>
                    <button onclick="showTab('specifications')" id="tab-specifications" class="py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700">
                        Thông số kỹ thuật
                    </button>
                </nav>
            </div>

            <div class="p-8">
                <div id="content-description" class="tab-content">
                    <h3 class="text-xl font-semibold mb-4">Mô tả sản phẩm</h3>
                    <p class="text-gray-700 leading-relaxed">@Model.Description</p>
                </div>

                <div id="content-specifications" class="tab-content hidden">
                    <h3 class="text-xl font-semibold mb-4">Thông số kỹ thuật</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        @foreach (var spec in Model.Specifications)
                        {
                            <div class="flex justify-between py-2 border-b border-gray-200">
                                <span class="font-medium text-gray-700">@spec.Key:</span>
                                <span class="text-gray-600">@spec.Value</span>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Related Products -->
        @if (ViewBag.RelatedProducts != null && ((List<LaptopShopWebsite.Models.Product>)ViewBag.RelatedProducts).Count > 0)
        {
            <div class="mb-16">
                <h2 class="text-2xl font-bold text-gray-900 mb-8">Sản phẩm liên quan</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    @foreach (var product in (List<LaptopShopWebsite.Models.Product>)ViewBag.RelatedProducts)
                    {
                        <div class="bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 group">
                            <div class="relative overflow-hidden rounded-t-xl">
                                <img src="@product.Image" alt="@product.Name" class="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300" />
                                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                                    <a asp-controller="Products" asp-action="Details" asp-route-id="@product.Id"
                                       class="bg-white text-gray-800 px-4 py-2 rounded-full opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-4 group-hover:translate-y-0 flex items-center space-x-2 hover:bg-gray-100">
                                        <i data-lucide="eye" class="h-4 w-4"></i>
                                        <span>Xem chi tiết</span>
                                    </a>
                                </div>
                            </div>
                            <div class="p-4">
                                <h3 class="font-semibold text-gray-800 mb-2 line-clamp-2">@product.Name</h3>
                                <div class="text-lg font-bold text-blue-700">
                                    @product.Price.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        lucide.createIcons();
        
        function changeImage(src) {
            document.getElementById('main-image').src = src;
        }
        
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active state from all tabs
            document.querySelectorAll('[id^="tab-"]').forEach(tab => {
                tab.classList.remove('border-blue-500', 'text-blue-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Show selected tab content
            document.getElementById('content-' + tabName).classList.remove('hidden');
            
            // Add active state to selected tab
            const activeTab = document.getElementById('tab-' + tabName);
            activeTab.classList.remove('border-transparent', 'text-gray-500');
            activeTab.classList.add('border-blue-500', 'text-blue-600');
        }
        
        function increaseQuantity() {
            const input = document.getElementById('quantity');
            const max = parseInt(input.getAttribute('max'));
            const current = parseInt(input.value);
            if (current < max) {
                input.value = current + 1;
            }
        }
        
        function decreaseQuantity() {
            const input = document.getElementById('quantity');
            const current = parseInt(input.value);
            if (current > 1) {
                input.value = current - 1;
            }
        }
        
        function addToCart(productId) {
            const quantity = parseInt(document.getElementById('quantity').value);
            $.post('/Cart/AddToCart', { productId: productId, quantity: quantity }, function(data) {
                if (data.success) {
                    $('#cart-count').text(data.cartCount);
                    $('#mobile-cart-count').text(data.cartCount);
                    alert(data.message);
                } else {
                    alert(data.message);
                }
            });
        }
    </script>
}